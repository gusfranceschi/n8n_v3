{"createdAt":"2025-06-02T14:42:52.641Z","updatedAt":"2025-06-05T19:02:06.341Z","id":"ZbQK414y4JdsAtW4","name":"10 - CRIA THUMB","active":true,"isArchived":false,"nodes":[{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-3140,460],"id":"5705ee1c-dddc-49ab-ae7f-2c638206d6b7","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"aFIpFp2J06rY600P","name":"OpenAi account"}}},{"parameters":{"rule":{"interval":[{"field":"hours"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-4500,240],"id":"fdf398ee-dbf4-4cad-88a5-71645cf628a5","name":"Verificação Periódica"},{"parameters":{"resource":"list","operation":"getCards","id":"={{ $item(\"0\").$node[\"Edit Fields\"].json[\"UPLOAD\"] }}","returnAll":true,"additionalFields":{}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-4060,240],"id":"f9359c97-cbda-4150-acb4-6f6e6b448b13","name":"Buscar Cartões Prontos para Thumbnail","credentials":{"trelloApi":{"id":"jIAgqh5oR1xZHXtP","name":"Trello account"}}},{"parameters":{},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-3620,240],"id":"244dacd2-9d58-45fe-a09d-fab727cb924b","name":"Selecionar Próximo Cartão"},{"parameters":{"promptType":"define","text":"={{ $json.desc }}","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-3180,240],"id":"75ef5d98-a689-4ab9-9db6-518c6bbdd061","name":"Extrair Metadados do Cartão"},{"parameters":{"jsonSchemaExample":"{\n\"título\": \"{{ $('Edit Fields2').item.json.pasta }}\",\n\"pasta\": \"{{ $('Edit Fields2').item.json.pasta }}\",\n\"id\": \"{{ $('Edit Fields2').item.json.audiolongo1 }}\",\n\"url\": \"{{ $('Edit Fields2').item.json.audiolongo2 }}\",\n\"data\": \"{{ $('Edit Fields2').item.json.audiolongo2 }}\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3020,460],"id":"dc2f19ff-cbac-42f3-874f-66ca8951bd27","name":"Formatador de Dados JSON"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"output"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-2800,240],"id":"a5e40f6b-3e09-4811-a20b-d5b3cf4ff94c","name":"Consolidar Dados do Cartão"},{"parameters":{"fieldToSplitOut":"output[0]['título'], output[0].pasta","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-2580,240],"id":"aea0d6d0-696e-4b93-948a-f1da14755320","name":"Extrair Título e Pasta"},{"parameters":{"assignments":{"assignments":[{"id":"20da253b-0135-4a09-a0e2-46342c2076c5","name":"título","value":"={{ $json['output[0][\\'título\\']'] }}","type":"string"},{"id":"cb5ec656-9691-450f-99f8-bb9f23a99ff8","name":"id","value":"={{ $json['output[0].pasta'] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2360,240],"id":"013d1de5-8a4e-4ef5-9250-e80fd2455503","name":"Formatar Dados para Processamento"},{"parameters":{"resource":"folder","name":"Thumb","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-2140,240],"id":"db275be5-6254-4232-982e-bed76b9abc27","name":"Criar Pasta para Miniaturas","credentials":{"googleDriveOAuth2Api":{"id":"DiHdZ190wOjmODAT","name":"Google Drive account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"GPT-4.1-MINI"},"messages":{"values":[{"content":"=Create a prompt for ChatGPT to create an image like a professional photograph based on the theme: {{ $item(\"0\").$node[\"Consolidar Dados do Cartão\"].json[\"output\"][\"0\"][\"título\"] }}. Show a clear and intense emotional expression [choose one: sadness/joy/anger/surprise/fear] appropriate to the title's context. Use lighting that highlights the main subject. Keep the realistic style with vivid colors. No text in the image. High resolution. Provide only the prompt. Return the text without double quotes, with 300 characters or a little more, clearly and objectively."}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-1920,240],"id":"563f491d-c9c8-4aca-8e91-9c221ff41c9a","name":"Gerar Descrição para Imagem","credentials":{"openAiApi":{"id":"aFIpFp2J06rY600P","name":"OpenAi account"}}},{"parameters":{"method":"POST","url":"https://api.together.xyz/v1/chat/completions","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $item(\"0\").$node[\"Edit Fields\"].json[\"Together API Key\"] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n\"model\": \"black-forest-labs/FLUX.1-schnell\",\n\"prompt\": {{ JSON.stringify ($json.message.content) }},\n\"width\": 1024,\n\"height\": 1024,\n\"steps\": 4,\n\"n\": 1,\n\"response_format\": \"b64_json\"\n}","options":{"batching":{"batch":{"batchSize":2,"batchInterval":10000}}}},"id":"fc30f021-14df-483d-ab0c-adc48396cb55","name":"Solicitar Imagem à Together.xyz","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1320,100]},{"parameters":{"operation":"toBinary","sourceProperty":"output.choices[0].image_base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1100,100],"id":"73cb2383-be0d-4f10-b625-d071f5a76cbe","name":"Converter Base64 para Arquivo"},{"parameters":{"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $('Criar Pasta para Miniaturas').item.json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-880,100],"id":"006ed773-2271-4e25-96b2-5d6bcba93f8d","name":"Salvar Imagem no Google Drive","credentials":{"googleDriveOAuth2Api":{"id":"DiHdZ190wOjmODAT","name":"Google Drive account"}}},{"parameters":{"operation":"share","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"permissionsUi":{"permissionsValues":{"role":"reader","type":"anyone"}},"options":{}},"id":"65bb4020-1b2a-4361-9153-8525c9e84c3a","name":"Tornar Imagem Pública","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-660,100],"credentials":{"googleDriveOAuth2Api":{"id":"DiHdZ190wOjmODAT","name":"Google Drive account"}}},{"parameters":{"url":"=https://api.placid.app/u/{{ $item(\"0\").$node[\"Edit Fields\"].json[\"Placid ID\"] }}?&img[image]={{ $('Salvar Imagem no Google Drive').item.json.webViewLink }}&text[text]={{ $('Formatar Dados para Processamento').item.json['título'] }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-440,100],"id":"3078b05b-576e-4bf1-8df4-7677ff20a51d","name":"Adicionar Texto à Imagem"},{"parameters":{"name":"Thumbnail ","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"={{ $('Criar Pasta para Miniaturas').item.json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-220,100],"id":"8211119c-282f-4373-9e65-2a3b574ef5c3","name":"Armazenar Thumbnail Final","retryOnFail":true,"credentials":{"googleDriveOAuth2Api":{"id":"DiHdZ190wOjmODAT","name":"Google Drive account"}},"onError":"continueErrorOutput"},{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[-4500,600],"id":"2c0da889-727d-44ec-b1a5-ea895f005b3d","name":"Detector de Falhas"},{"parameters":{"chatId":"-1002615111216","text":"=10 - CRIA THUMB","additionalFields":{"appendAttribution":false,"message_thread_id":5}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-4280,600],"id":"472ed353-c626-410e-a976-483153463d86","name":"Notificação de Erro no Telegram","webhookId":"69e81cf7-6366-4150-8ea9-0179f2447587","credentials":{"telegramApi":{"id":"KbYurROyBoGKf7Ks","name":"Telegram account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"id\"] }}","mode":""},"updateFields":{"idList":"={{ $item(\"0\").$node[\"Edit Fields\"].json[\"THUMB\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[220,0],"id":"066f9fed-99ad-415f-a98a-314b80b40943","name":"Mover Cartão para \"THUMB ✅\"","credentials":{"trelloApi":{"id":"jIAgqh5oR1xZHXtP","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"id\"] }}","mode":"id"},"updateFields":{"desc":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"desc\"] }}\"thumb\": \"{{ $item(\"0\").$node[\"Armazenar Thumbnail Final\"].json[\"id\"] }}\","}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[0,0],"id":"c59b8114-d9d2-46a2-9339-7e06c679bd6e","name":"Atualizar Detalhes do Cartão","credentials":{"trelloApi":{"id":"jIAgqh5oR1xZHXtP","name":"Trello account"}}},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1320,340],"id":"cec5c481-a0e1-40af-b075-9f5d49c4621f","name":"Aguardar e Retentar 1","webhookId":"bfdb6791-3ed1-41ac-b174-47202fa91144"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a7077994-496c-427f-a27d-a8cd607f7be8","leftValue":"={{ $json.message.content.length }}","rightValue":300,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1540,160],"id":"06f36444-ca75-4f1b-8106-6af026deba12","name":"Verificar Caracteres do Prompt"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"015448b3-2848-46c1-92d6-cc3f867bbed1","leftValue":"={{ $json.name }}","rightValue":"\"STOP\"","operator":{"type":"string","operation":"notContains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-3840,240],"id":"3120dbcb-1237-4f3b-857d-4b285439fc27","name":"Exclui Cards em \"STOP\""},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"name":"={{ $json.name }} \"STOP\""}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[-3400,240],"id":"88308e04-5d5a-4bb0-a0c0-aaa634a7ca0b","name":"Atualizar Cartão com \"STOP\"","credentials":{"trelloApi":{"id":"jIAgqh5oR1xZHXtP","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"updateFields":{"name":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"name\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[440,0],"id":"8f8f6f6f-93b5-4383-9707-7cfcaa4b6f90","name":"Remove \"STOP\"","credentials":{"trelloApi":{"id":"jIAgqh5oR1xZHXtP","name":"Trello account"}}},{"parameters":{"operation":"update","id":{"__rl":true,"value":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"id\"] }}","mode":"id"},"updateFields":{"name":"={{ $item(\"0\").$node[\"Selecionar Próximo Cartão\"].json[\"name\"] }}"}},"type":"n8n-nodes-base.trello","typeVersion":1,"position":[0,200],"id":"40506e48-df87-4f46-9779-fe71ceadbe5b","name":"Remove \"STOP\" 2","credentials":{"trelloApi":{"id":"jIAgqh5oR1xZHXtP","name":"Trello account"}}},{"parameters":{"chatId":"-1002615111216","text":"=10 - CRIA THUMB","additionalFields":{"appendAttribution":false,"message_thread_id":4}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[220,200],"id":"aeab8402-0a4b-42a6-9a48-e450804f2388","name":"Notificação de Erro no Telegram 2","webhookId":"69e81cf7-6366-4150-8ea9-0179f2447587","credentials":{"telegramApi":{"id":"KbYurROyBoGKf7Ks","name":"Telegram account"}}},{"parameters":{"assignments":{"assignments":[{"id":"948aa1b6-75d6-4cf6-9cd1-629b97a571d6","name":"UPLOAD","value":"682b2e0278df7956373f0b4c","type":"string"},{"id":"41fb9577-343d-439a-bacf-65018b3f194c","name":"THUMB","value":"682b2e0278df7956373f0b4b","type":"string"},{"id":"c7b22a26-08c8-4644-98cd-01e48b951384","name":"Together API Key","value":"7ef35fb6b84bc5359368aa3f4569d3e13a4db1ff6aa5bec1bdf9209322c303ab","type":"string"},{"id":"5c9f7412-0fde-4d7f-83e4-99491599c0e1","name":"Placid ID","value":"eq9svs3opm3te","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4280,240],"id":"1ceadf6e-bf94-4d14-a027-d7b9e0126041","name":"Edit Fields"}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Extrair Metadados do Cartão","type":"ai_languageModel","index":0}]]},"Verificação Periódica":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Buscar Cartões Prontos para Thumbnail":{"main":[[{"node":"Exclui Cards em \"STOP\"","type":"main","index":0}]]},"Selecionar Próximo Cartão":{"main":[[{"node":"Atualizar Cartão com \"STOP\"","type":"main","index":0}]]},"Extrair Metadados do Cartão":{"main":[[{"node":"Consolidar Dados do Cartão","type":"main","index":0}]]},"Formatador de Dados JSON":{"ai_outputParser":[[{"node":"Extrair Metadados do Cartão","type":"ai_outputParser","index":0}]]},"Consolidar Dados do Cartão":{"main":[[{"node":"Extrair Título e Pasta","type":"main","index":0}]]},"Extrair Título e Pasta":{"main":[[{"node":"Formatar Dados para Processamento","type":"main","index":0}]]},"Formatar Dados para Processamento":{"main":[[{"node":"Criar Pasta para Miniaturas","type":"main","index":0}]]},"Criar Pasta para Miniaturas":{"main":[[{"node":"Gerar Descrição para Imagem","type":"main","index":0}]]},"Gerar Descrição para Imagem":{"main":[[{"node":"Verificar Caracteres do Prompt","type":"main","index":0}]]},"Solicitar Imagem à Together.xyz":{"main":[[{"node":"Converter Base64 para Arquivo","type":"main","index":0}]]},"Converter Base64 para Arquivo":{"main":[[{"node":"Salvar Imagem no Google Drive","type":"main","index":0}]]},"Salvar Imagem no Google Drive":{"main":[[{"node":"Tornar Imagem Pública","type":"main","index":0}]]},"Tornar Imagem Pública":{"main":[[{"node":"Adicionar Texto à Imagem","type":"main","index":0}]]},"Adicionar Texto à Imagem":{"main":[[{"node":"Armazenar Thumbnail Final","type":"main","index":0}]]},"Armazenar Thumbnail Final":{"main":[[{"node":"Atualizar Detalhes do Cartão","type":"main","index":0}],[{"node":"Remove \"STOP\" 2","type":"main","index":0}]]},"Detector de Falhas":{"main":[[{"node":"Notificação de Erro no Telegram","type":"main","index":0}]]},"Mover Cartão para \"THUMB ✅\"":{"main":[[{"node":"Remove \"STOP\"","type":"main","index":0}]]},"Atualizar Detalhes do Cartão":{"main":[[{"node":"Mover Cartão para \"THUMB ✅\"","type":"main","index":0}]]},"Aguardar e Retentar 1":{"main":[[{"node":"Gerar Descrição para Imagem","type":"main","index":0}]]},"Verificar Caracteres do Prompt":{"main":[[{"node":"Solicitar Imagem à Together.xyz","type":"main","index":0}],[{"node":"Aguardar e Retentar 1","type":"main","index":0}]]},"Exclui Cards em \"STOP\"":{"main":[[{"node":"Selecionar Próximo Cartão","type":"main","index":0}]]},"Atualizar Cartão com \"STOP\"":{"main":[[{"node":"Extrair Metadados do Cartão","type":"main","index":0}]]},"Remove \"STOP\" 2":{"main":[[{"node":"Notificação de Erro no Telegram 2","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Buscar Cartões Prontos para Thumbnail","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Verificação Periódica":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"8ae16ebe-e8b5-4b4b-bc2e-3f374aefa5a0","triggerCount":1,"tags":[{"createdAt":"2025-06-03T13:08:52.656Z","updatedAt":"2025-06-03T13:08:52.656Z","id":"5X46tRV4lwQwBhLN","name":"teste ok"}]}